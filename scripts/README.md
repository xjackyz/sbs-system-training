# 代码结构更新工具

本目录包含用于更新SBS系统代码结构的工具脚本。这些工具用于确保项目的文件组织符合新的目录结构，并更新代码中的导入路径。

## 可用脚本

1. `update_code_structure.py` - 主脚本，用于执行完整的更新过程
2. `update_imports.py` - 更新导入路径的工具脚本

## 使用方法

### 基本用法

运行主更新脚本：

```bash
python scripts/update_code_structure.py
```

这将执行以下操作：
- 验证项目目录结构
- 创建必要的`__init__.py`文件
- 更新导入路径
- 运行测试以确保更改不会破坏功能

### 预览模式

如果您想查看将要进行的更改而不实际修改文件，可以使用`--dry-run`选项：

```bash
python scripts/update_code_structure.py --dry-run
```

### 自定义处理目录

默认情况下，脚本将处理以下目录：`src`, `app`, `tests`, `scripts`, `sbs_bot`。您可以通过`--dirs`选项指定要处理的目录：

```bash
python scripts/update_code_structure.py --dirs src app tests
```

### 其他选项

- `--skip-init` - 跳过创建`__init__.py`文件
- `--skip-tests` - 跳过运行测试
- `--test-path tests/unit` - 指定要运行的测试路径

## 导入路径映射

`update_imports.py`脚本包含一个详细的导入路径映射表，用于将旧的导入路径转换为新的路径。如果您需要添加新的映射，请编辑该文件中的`PATH_MAPPINGS`字典。

## 注意事项

1. 在运行脚本之前，建议备份您的代码或确保所有更改已提交到版本控制系统
2. 更新后，可能仍需要手动调整一些复杂的导入或特殊情况
3. 对于生成的`__init__.py`文件，您可能需要添加适当的导入语句

## 排除故障

如果您在更新过程中遇到问题，请检查以下几点：

1. 确保所有必需的目录结构都已创建
2. 检查是否有特殊的导入语句没有被正确处理
3. 运行单个测试文件，而不是整个测试套件，以便更容易定位问题

如果问题仍然存在，请查看脚本生成的错误输出，它通常会提供有用的信息来帮助解决问题。 